<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home | WatermelonKatana</title>
  <link rel="icon" href="/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" href="/favicon/favicon.svg" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="WatermelonKatana" />
  <link rel="manifest" href="/site.webmanifest">
  <meta property="og:title" content="WatermelonKatana" />
  <meta property="og:type" content="profile" />
  <meta property="og:image" content="/favicon/android-chrome-192x192.png" />
  <meta property="og:description" content="Explore, share, and enjoy a large gallery of browser games and community projects!" />
  <link rel="stylesheet" href="/styles/main.css">
  <script src="/scripts/HtmlSanitizer.js"></script>
  <script src="/scripts/script.js"></script>
</head>
<body>
<div class="container">
  <header class="main-header">
    <h1>Welcome to <span class="logo-text">WatermelonKatana</span></h1>
    <h2 id="username"></h2>
    <nav class="main-nav" id="header">
      <a href="/register">Register</a>
      <a href="/login">Login</a>
      <a href="/chat">Chat</a>
      <a href="/search">Project Gallery</a>
      <a href="/forum">Forum</a>
      <a href="/updates">Announcements</a>
    </nav>
  </header>
  <main>
    <section class="intro">
      <p>Explore, share, and enjoy a large gallery of browser games and community projects. Help us grow by sharing your games or trying othersâ€™ creations!</p>
      <a class="discord-link" href="https://discord.gg/S8XTzKEz5f">Join our Discord!</a>
    </section>
    <section class="featured-projects">
      <h2>Featured Projects</h2>
      <div id="featuredList" class="project-list"></div>
    </section>
    <section class="featured-projects">
      <h2>Latest Projects</h2>
      <div id="latestList" class="project-list"></div>
    </section>
    <section class="featured-projects">
      <h2>Hot Forum Topics</h2>
      <div id="postlist" class="post-list"></div>
    </section>
  </main>
  <footer>
    <p>&copy; 2024 WatermelonKatana. All rights reserved.</p>
  </footer>
</div>

<script>
  const updateSection = async (url, params, container, mapper) => {
    const tok = await getAuth();
    params.set("showMature", tok.user?.mature || false);
    const res = await fetch(`${url}?${params}`);
    const data = await res.json();
    data.projects?.slice(0, 5).forEach(proj => mapper(container, tok, proj));
    data.posts?.slice(0, 5).forEach(post => mapper(container, tok, post));
  };

  const setupUser = async () => {
    const data = await getAuth();
    const user = document.getElementById('username');
    const header = document.getElementById('header');
    if (data.auth) {
      user.innerHTML = `<p>Signed in as <strong class="logo-text">${data.user.username}</strong></p>`;
      header.innerHTML = `
            <a href="/publish">Publish</a>
            <a href="/chat">Chat</a>
            <a href="/search">Project Gallery</a>
            <a href="/forum">Forum</a>
            <a href="/updates">Announcements</a>
            <a href="/userlist">User List</a>
            ${data.user.role === 'Admin' ? '<a href="/admin">Admin Panel</a>' : ''}
          `;
    }
  };

  document.addEventListener('DOMContentLoaded', () => {
    setupUser();
    updateSection('/api/project/list', new URLSearchParams({ featured: 1 }), document.querySelector('#featuredList'), projHTML);
    updateSection('/api/project/list', new URLSearchParams(), document.querySelector('#latestList'), projHTML);
    updateSection('/api/forum/list', new URLSearchParams(), document.querySelector('#postlist'), forumHTML);
  });
</script>
</body>
</html>
